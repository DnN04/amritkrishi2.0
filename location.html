<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter Location - AmritKrishi</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="min-h-screen relative overflow-hidden">
        <!-- Background -->
        <div class="background-image">
            <div class="overlay"></div>
        </div>

        <!-- Navigation Header -->
        <nav class="nav-container">
            <div class="nav-left">
                <a href="index.html" class="logo-link">
                    <span class="logo-text" data-i18n="navTitle">AmritKrishi</span>
                </a>
                <div class="nav-links">
                    <!-- <button class="nav-link" data-i18n="navFeatures">Features</button>
                    <button class="nav-link" data-i18n="navLanguage">Language</button>
                    <button class="nav-link" data-i18n="navAbout">About</button> -->
                    <div class="nav-links">
    <!-- <a href="index.html" class="nav-link">Home</a> -->
    <a href="about.html" class="nav-link">About</a>
        <a href="features.html" class="nav-link">Features</a>
    <!-- <a href="location.html" class="nav-link">Location</a>
    <a href="results.html" class="nav-link">Results</a> -->
</div>
                    
                </div>
            </div>
            <!-- <div class="nav-right">
                <div class="current-language-display">
                    <span id="currentLangDisplay">English</span>
                </div>
            </div> -->
            <div class="nav-right">
    <div class="language-select-container">
        <select id="languageSelect" class="language-select">
            <option value="en">English</option>
            <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
            <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
            <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
        </select>
    </div>
</div>
<!-- <div class="nav-right">
    <div class="custom-language-dropdown">
        <div class="dropdown-selected" id="languageSelected">
            <span>English</span>
            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 10l5 5 5-5z"/>
            </svg>
        </div>
        <div class="dropdown-options" id="languageOptions">
            <div class="dropdown-option" data-value="en">English</div>
            <div class="dropdown-option" data-value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</div>
            <div class="dropdown-option" data-value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</div>
            <div class="dropdown-option" data-value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</div>
        </div>
    </div>
</div> -->
        </nav>

        <!-- Location Input Content -->
        <div class="location-main-content">
            <div class="location-container">
                <!-- Progress Indicator -->
                <div class="progress-indicator">
                    <div class="progress-step active">
                        <div class="step-number">1</div>
                        <span class="step-text" data-i18n="stepLocation">Location</span>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">2</div>
                        <span class="step-text" data-i18n="stepAnalysis">Analysis</span>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">3</div>
                        <span class="step-text" data-i18n="stepResults">Results</span>
                    </div>
                </div>

                <!-- Main Form -->
                <div class="location-form-container">
                    <h2 class="form-title" data-i18n="formTitle">Enter Your Farm Location</h2>
                    <p class="form-subtitle" data-i18n="formSubtitle">We'll analyze soil and climate to recommend the best crops</p>

                    <form class="location-form" id="locationForm">
                        <!-- Name Input -->
                        <div class="form-group">
                            <label for="farmerName" class="form-label" data-i18n="labelName">Your Name</label>
                            <input type="text" id="farmerName" class="form-input" placeholder="Enter your name" required>
                        </div>

                        <!-- Location Method Selection -->
                        <div class="form-group">
                            <label class="form-label" data-i18n="labelMethod">Choose Location Method</label>
                            <div class="method-buttons">
                                <button type="button" class="method-btn active" data-method="gps" id="gpsBtn">
                                    <span class="method-icon">üìç</span>
                                    <span>Current Location</span>
                                </button>
                                <button type="button" class="method-btn" data-method="search" id="searchBtn">
                                    <span class="method-icon">üîç</span>
                                    <span>Search Place</span>
                                </button>
                            </div>
                        </div>

                        <!-- GPS Location Section -->
                        <div class="method-section active" id="gpsSection">
                            <div class="gps-instructions">
                                <p>Click the button below to automatically detect your location</p>
                                <button type="button" class="gps-detect-btn" id="detectLocationBtn">
                                    <span class="gps-icon">üåê</span>
                                    Detect My Location
                                </button>
                            </div>
                            
                            <div class="location-result" id="gpsResult" style="display: none;">
                                <div class="location-success">
                                    <span class="success-icon">‚úÖ</span>
                                    <div class="location-details">
                                        <strong>Location Detected!</strong>
                                        <div id="gpsCoordinates">Latitude: --, Longitude: --</div>
                                        <div id="gpsAddress">Address: Detecting...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Search Location Section -->
                        <div class="method-section" id="searchSection">
                            <div class="search-container">
                                <div class="search-input-group">
                                    <input type="text" id="searchInput" class="search-input" 
                                           placeholder="Enter city, village, or area name..." 
                                           autocomplete="off">
                                    <button type="button" class="search-btn" id="searchLocationBtn">
                                        <span class="search-icon">üîç</span>
                                        Search
                                    </button>
                                </div>
                                
                                <div class="search-suggestions" id="searchSuggestions">
                                    <div class="suggestion-header">Popular Indian Locations:</div>
                                    <div class="suggestions-grid">
                                        <div class="suggestion-item" data-place="Delhi, India">Delhi</div>
                                        <div class="suggestion-item" data-place="Mumbai, India">Mumbai</div>
                                        <div class="suggestion-item" data-place="Bangalore, India">Bangalore</div>
                                        <div class="suggestion-item" data-place="Chennai, India">Chennai</div>
                                        <div class="suggestion-item" data-place="Kolkata, India">Kolkata</div>
                                        <div class="suggestion-item" data-place="Hyderabad, India">Hyderabad</div>
                                        <div class="suggestion-item" data-place="Pune, India">Pune</div>
                                        <div class="suggestion-item" data-place="Ahmedabad, India">Ahmedabad</div>
                                        <div class="suggestion-item" data-place="Jaipur, India">Jaipur</div>
                                        <div class="suggestion-item" data-place="Lucknow, India">Lucknow</div>
                                        <div class="suggestion-item" data-place="Chandigarh, India">Chandigarh</div>
                                        <div class="suggestion-item" data-place="Bhopal, India">Bhopal</div>
                                    </div>
                                </div>
                                
                                <div class="search-results" id="searchResults" style="display: none;">
                                    <div class="results-header">Search Results:</div>
                                    <div class="results-list" id="resultsList"></div>
                                </div>
                                
                                <div class="selected-search-result" id="selectedSearchResult" style="display: none;">
                                    <div class="location-success">
                                        <span class="success-icon">‚úÖ</span>
                                        <div class="location-details">
                                            <strong>Location Selected!</strong>
                                            <div id="searchCoordinates">Latitude: --, Longitude: --</div>
                                            <div id="searchAddress">Address: --</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Selected Location Display -->
                        <div class="selected-location" id="selectedLocation" style="display: none;">
                            <div class="location-display">
                                <span class="location-icon">üìå</span>
                                <div class="location-info">
                                    <strong>Selected Location:</strong>
                                    <div id="locationText">No location selected</div>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="submit-btn" id="submitBtn" disabled>
                            <span data-i18n="btnAnalyze">Analyze My Farm</span>
                            <span class="loading-spinner" style="display: none;">‚è≥</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- INCLUDE SHARED LANGUAGE SYSTEM -->
    <script src="js/shared-language.js"></script>
    
    <script>
        // Location page functionality
        let currentMethod = 'gps';
        let selectedLocation = null;

        document.addEventListener('DOMContentLoaded', function() {
            console.log("üìç LOCATION PAGE LOADED");
            initializeLocationPage();
        });

        function initializeLocationPage() {
            // Method selection
            document.getElementById('gpsBtn').addEventListener('click', () => setActiveMethod('gps'));
            document.getElementById('searchBtn').addEventListener('click', () => setActiveMethod('search'));
            
            // GPS detection
            document.getElementById('detectLocationBtn').addEventListener('click', detectLocation);
            
            // Search functionality
            document.getElementById('searchLocationBtn').addEventListener('click', searchLocation);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchLocation();
                }
            });
            
            // Quick suggestions
            document.querySelectorAll('.suggestion-item').forEach(item => {
                item.addEventListener('click', function() {
                    const place = this.getAttribute('data-place');
                    document.getElementById('searchInput').value = place;
                    searchLocation();
                });
            });
            
            // Form submission
            document.getElementById('locationForm').addEventListener('submit', handleFormSubmit);
            
            // Name input validation
            document.getElementById('farmerName').addEventListener('input', updateSubmitButton);
        }

        function setActiveMethod(method) {
            currentMethod = method;
            
            // Update active button
            document.getElementById('gpsBtn').classList.toggle('active', method === 'gps');
            document.getElementById('searchBtn').classList.toggle('active', method === 'search');
            
            // Show/hide sections
            document.getElementById('gpsSection').classList.toggle('active', method === 'gps');
            document.getElementById('searchSection').classList.toggle('active', method === 'search');
            
            // Reset selection
            selectedLocation = null;
            updateSubmitButton();
            hideSelectedLocation();
            
            // Clear search results when switching to search
            if (method === 'search') {
                clearSearchResults();
            }
        }

        function detectLocation() {
            const btn = document.getElementById('detectLocationBtn');
            const result = document.getElementById('gpsResult');
            
            btn.innerHTML = '<span class="gps-icon">üåê</span> Detecting...';
            btn.disabled = true;
            
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by your browser. Please use search method.');
                resetGPSButton();
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Show success
                    document.getElementById('gpsCoordinates').textContent = 
                        `Latitude: ${lat.toFixed(6)}, Longitude: ${lng.toFixed(6)}`;
                    
                    // Get address
                    getAddressFromCoords(lat, lng, 'gps');
                    
                    // Set selected location
                    selectedLocation = {
                        latitude: lat,
                        longitude: lng,
                        method: 'gps'
                    };
                    
                    result.style.display = 'block';
                    showSelectedLocation(`GPS Location (${lat.toFixed(4)}, ${lng.toFixed(4)})`);
                    updateSubmitButton();
                    resetGPSButton();
                },
                function(error) {
                    let errorMessage = 'Unable to detect your location. ';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Please allow location access and try again.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Location request timed out.';
                            break;
                        default:
                            errorMessage += 'An unknown error occurred.';
                    }
                    
                    alert(errorMessage);
                    resetGPSButton();
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // function searchLocation() {
        //     const searchInput = document.getElementById('searchInput');
        //     const searchTerm = searchInput.value.trim();
        //     const searchBtn = document.getElementById('searchLocationBtn');
            
        //     if (!searchTerm) {
        //         alert('Please enter a location to search.');
        //         return;
        //     }
            
        //     searchBtn.innerHTML = '<span class="search-icon">üîç</span> Searching...';
        //     searchBtn.disabled = true;
            
        //     // Clear previous results
        //     clearSearchResults();
            
        //     // Simulate API call to geocoding service
        //     setTimeout(() => {
        //         const mockResults = generateMockSearchResults(searchTerm);
        //         displaySearchResults(mockResults);
                
        //         searchBtn.innerHTML = '<span class="search-icon">üîç</span> Search';
        //         searchBtn.disabled = false;
        //     }, 1500);
        // }
        //apiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii
async function searchLocation() {
    const searchInput = document.getElementById('searchInput');
    const searchTerm = searchInput.value.trim();
    const searchBtn = document.getElementById('searchLocationBtn');
    
    if (!searchTerm) {
        alert('Please enter a location to search.');
        return;
    }
    
    searchBtn.innerHTML = '<span class="search-icon">üîç</span> Searching...';
    searchBtn.disabled = true;
    
    try {
        // Using OpenStreetMap Nominatim API (free)
        const response = await fetch(
            `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchTerm + ', India')}&limit=5`
        );
        
        const data = await response.json();
        
        if (data.length === 0) {
            // Fallback to mock data if no results
            const mockResults = generateMockSearchResults(searchTerm);
            displaySearchResults(mockResults);
        } else {
            const formattedResults = data.map(item => ({
                name: item.display_name,
                lat: parseFloat(item.lat),
                lng: parseFloat(item.lon),
                type: item.type
            }));
            displaySearchResults(formattedResults);
        }
    } catch (error) {
        console.error('Geocoding API error:', error);
        // Fallback to mock data
        const mockResults = generateMockSearchResults(searchTerm);
        displaySearchResults(mockResults);
    } finally {
        searchBtn.innerHTML = '<span class="search-icon">üîç</span> Search';
        searchBtn.disabled = false;
    }
}
        // function generateMockSearchResults(searchTerm) {
        //     // Mock data for demonstration - in real app, use Google Maps Geocoding API
        //     const baseResults = [
        //         {
        //             name: `${searchTerm}, India`,
        //             lat: 28.6139 + (Math.random() - 0.5) * 0.1,
        //             lng: 77.2090 + (Math.random() - 0.5) * 0.1,
        //             type: 'city'
        //         },
        //         {
        //             name: `${searchTerm} District, India`,
        //             lat: 28.6139 + (Math.random() - 0.5) * 0.2,
        //             lng: 77.2090 + (Math.random() - 0.5) * 0.2,
        //             type: 'administrative'
        //         },
        //         {
        //             name: `${searchTerm} Rural Area, India`,
        //             lat: 28.6139 + (Math.random() - 0.5) * 0.3,
        //             lng: 77.2090 + (Math.random() - 0.5) * 0.3,
        //             type: 'village'
        //         }
        //     ];
            
        //     return baseResults;
        // }

        function generateMockSearchResults(searchTerm) {
    // Get region-specific base coordinates based on search term
    const regionCoords = getRegionCoordinates(searchTerm);
    
    const baseResults = [
        {
            name: `${searchTerm}, India`,
            lat: regionCoords.lat + (Math.random() - 0.5) * 0.1,
            lng: regionCoords.lng + (Math.random() - 0.5) * 0.1,
            type: 'city'
        },
        {
            name: `${searchTerm} District, India`,
            lat: regionCoords.lat + (Math.random() - 0.5) * 0.2,
            lng: regionCoords.lng + (Math.random() - 0.5) * 0.2,
            type: 'administrative'
        },
        {
            name: `${searchTerm} Rural Area, India`,
            lat: regionCoords.lat + (Math.random() - 0.5) * 0.3,
            lng: regionCoords.lng + (Math.random() - 0.5) * 0.3,
            type: 'village'
        }
    ];
    
    return baseResults;
}

function getRegionCoordinates(searchTerm) {
    // Convert search term to lowercase for case-insensitive matching
    const term = searchTerm.toLowerCase();
    
    // Define coordinates for major Indian regions
    const regionMap = {
        // Northern India
        'delhi': { lat: 28.6139, lng: 77.2090 },
        'punjab': { lat: 31.1471, lng: 75.3412 },
        'haryana': { lat: 29.0588, lng: 76.0856 },
        'uttar pradesh': { lat: 26.8467, lng: 80.9462 },
        'uttarakhand': { lat: 30.0668, lng: 79.0193 },
        'himachal': { lat: 31.1048, lng: 77.1734 },
        
        // Southern India
        'bangalore': { lat: 12.9716, lng: 77.5946 },
        'chennai': { lat: 13.0827, lng: 80.2707 },
        'hyderabad': { lat: 17.3850, lng: 78.4867 },
        'kerala': { lat: 10.8505, lng: 76.2711 },
        'tamil nadu': { lat: 11.1271, lng: 78.6569 },
        'karnataka': { lat: 15.3173, lng: 75.7139 },
        'andhra': { lat: 15.9129, lng: 79.7400 },
        
        // Western India
        'mumbai': { lat: 19.0760, lng: 72.8777 },
        'pune': { lat: 18.5204, lng: 73.8567 },
        'gujarat': { lat: 22.2587, lng: 71.1924 },
        'maharashtra': { lat: 19.7515, lng: 75.7139 },
        'goa': { lat: 15.2993, lng: 74.1240 },
        
        // Eastern India
        'kolkata': { lat: 22.5726, lng: 88.3639 },
        'odisha': { lat: 20.9517, lng: 85.0985 },
        'west bengal': { lat: 22.9868, lng: 87.8550 },
        'bihar': { lat: 25.0961, lng: 85.3131 },
        'jharkhand': { lat: 23.6102, lng: 85.2799 },
        
        // Central India
        'madhya pradesh': { lat: 22.9734, lng: 78.6569 },
        'chhattisgarh': { lat: 21.2787, lng: 81.8661 },
        'rajasthan': { lat: 27.0238, lng: 74.2179 },
        
        // Northeastern India
        'assam': { lat: 26.2006, lng: 92.9376 },
        'nagaland': { lat: 26.1584, lng: 94.5624 },
        'manipur': { lat: 24.6637, lng: 93.9063 },
        'mizoram': { lat: 23.1645, lng: 92.9376 },
        'tripura': { lat: 23.9408, lng: 91.9882 },
        'meghalaya': { lat: 25.4670, lng: 91.3662 },
        'arunachal': { lat: 28.2180, lng: 94.7278 },
        'sikkim': { lat: 27.5330, lng: 88.5122 }
    };
    
    // Try to find matching region
    for (const [region, coords] of Object.entries(regionMap)) {
        if (term.includes(region)) {
            return coords;
        }
    }
    
    // If no specific region found, use a fallback based on first letter
    const firstChar = term.charAt(0);
    const fallbackCoords = {
        'a': { lat: 15.2993, lng: 74.1240 }, // Goa area
        'b': { lat: 12.9716, lng: 77.5946 }, // Bangalore area
        'c': { lat: 13.0827, lng: 80.2707 }, // Chennai area
        'd': { lat: 28.6139, lng: 77.2090 }, // Delhi area
        'e': { lat: 22.5726, lng: 88.3639 }, // Kolkata area
        'f': { lat: 19.0760, lng: 72.8777 }, // Mumbai area
        'g': { lat: 22.2587, lng: 71.1924 }, // Gujarat area
        'h': { lat: 29.0588, lng: 76.0856 }, // Haryana area
        'i': { lat: 26.8467, lng: 80.9462 }, // UP area
        'j': { lat: 23.6102, lng: 85.2799 }, // Jharkhand area
        'k': { lat: 10.8505, lng: 76.2711 }, // Kerala area
        'l': { lat: 26.2006, lng: 92.9376 }, // Assam area
        'm': { lat: 22.9734, lng: 78.6569 }, // MP area
        'n': { lat: 27.0238, lng: 74.2179 }, // Rajasthan area
        'o': { lat: 20.9517, lng: 85.0985 }, // Odisha area
        'p': { lat: 18.5204, lng: 73.8567 }, // Pune area
        'q': { lat: 17.3850, lng: 78.4867 }, // Hyderabad area
        'r': { lat: 26.1584, lng: 94.5624 }, // Nagaland area
        's': { lat: 15.3173, lng: 75.7139 }, // Karnataka area
        't': { lat: 11.1271, lng: 78.6569 }, // Tamil Nadu area
        'u': { lat: 30.0668, lng: 79.0193 }, // Uttarakhand area
        'v': { lat: 25.0961, lng: 85.3131 }, // Bihar area
        'w': { lat: 22.9868, lng: 87.8550 }, // West Bengal area
        'x': { lat: 21.2787, lng: 81.8661 }, // Chhattisgarh area
        'y': { lat: 31.1471, lng: 75.3412 }, // Punjab area
        'z': { lat: 31.1048, lng: 77.1734 }  // Himachal area
    };
    
    return fallbackCoords[firstChar] || { lat: 20.5937, lng: 78.9629 }; // Default: Center of India
}

        function displaySearchResults(results) {
            const resultsList = document.getElementById('resultsList');
            const searchResults = document.getElementById('searchResults');
            
            resultsList.innerHTML = '';
            
            if (results.length === 0) {
                resultsList.innerHTML = '<div class="no-results">No locations found. Try a different search term.</div>';
            } else {
                results.forEach((result, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    resultItem.innerHTML = `
                        <div class="result-main">
                            <strong>${result.name}</strong>
                            <span class="result-type">${result.type}</span>
                        </div>
                        <div class="result-coords">
                            ${result.lat.toFixed(4)}¬∞, ${result.lng.toFixed(4)}¬∞
                        </div>
                        <button class="select-result-btn" data-index="${index}">Select</button>
                    `;
                    resultsList.appendChild(resultItem);
                });
                
                // Add event listeners to select buttons
                document.querySelectorAll('.select-result-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        selectSearchResult(results[index]);
                    });
                });
            }
            
            searchResults.style.display = 'block';
        }

        function selectSearchResult(result) {
            const selectedResult = document.getElementById('selectedSearchResult');
            
            // Update display
            document.getElementById('searchCoordinates').textContent = 
                `Latitude: ${result.lat.toFixed(6)}, Longitude: ${result.lng.toFixed(6)}`;
            document.getElementById('searchAddress').textContent = `Address: ${result.name}`;
            
            // Set selected location
            selectedLocation = {
                latitude: result.lat,
                longitude: result.lng,
                method: 'search',
                address: result.name
            };
            
            selectedResult.style.display = 'block';
            showSelectedLocation(`Search: ${result.name}`);
            updateSubmitButton();
            
            // Hide search results
            document.getElementById('searchResults').style.display = 'none';
        }

        function clearSearchResults() {
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('selectedSearchResult').style.display = 'none';
            document.getElementById('resultsList').innerHTML = '';
        }

        function getAddressFromCoords(lat, lng, method) {
            // Simulated address lookup
            const addressElement = method === 'gps' ? 
                document.getElementById('gpsAddress') : 
                document.getElementById('searchAddress');
                
            addressElement.textContent = 'Address: Looking up...';
            
            setTimeout(() => {
                const addresses = [
                    'Agricultural land detected',
                    'Rural area identified', 
                    'Farmland location confirmed',
                    'Agricultural zone recognized',
                    'Farming region located'
                ];
                const randomAddress = addresses[Math.floor(Math.random() * addresses.length)];
                addressElement.textContent = `Area: ${randomAddress}`;
            }, 1500);
        }

        function resetGPSButton() {
            const btn = document.getElementById('detectLocationBtn');
            btn.innerHTML = '<span class="gps-icon">üåê</span> Detect My Location';
            btn.disabled = false;
        }

        function showSelectedLocation(text) {
            document.getElementById('locationText').textContent = text;
            document.getElementById('selectedLocation').style.display = 'block';
        }

        function hideSelectedLocation() {
            document.getElementById('selectedLocation').style.display = 'none';
        }

        function updateSubmitButton() {
            const farmerName = document.getElementById('farmerName').value.trim();
            const submitBtn = document.getElementById('submitBtn');
            
            submitBtn.disabled = !(selectedLocation && farmerName);
        }

     function handleFormSubmit(e) {
    e.preventDefault();
    
    const farmerName = document.getElementById('farmerName').value.trim();
    
    if (!selectedLocation || !farmerName) {
        alert('Please provide both your name and location.');
        return;
    }
    
    console.log("üìç SELECTED LOCATION DATA:", selectedLocation);
    
    // Prepare data for backend
    const formData = {
        farmerName: farmerName,
        latitude: selectedLocation.latitude,
        longitude: selectedLocation.longitude,
        locationMethod: selectedLocation.method,
        address: selectedLocation.address || 'Detected location'
    };
    
    console.log("üöÄ SENDING TO BACKEND:", formData);
    
    // Show loading
    const submitBtn = document.getElementById('submitBtn');
    const spinner = submitBtn.querySelector('.loading-spinner');
    const btnText = submitBtn.querySelector('span:first-child');
    
    btnText.textContent = 'Analyzing Soil & Climate...';
    spinner.style.display = 'inline';
    submitBtn.disabled = true;
    
    // Send to Java backend
    fetch('http://localhost:8080/api/analysis/recommend', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        console.log("üì® Backend response status:", response.status);
        if (!response.ok) {
            throw new Error('Network response was not ok: ' + response.status);
        }
        return response.json();
    })
    .then(data => {
        console.log("‚úÖ BACKEND RESPONSE RECEIVED:", data);
        
        // ‚úÖ CRITICAL FIX: Save BOTH backend response AND coordinates separately
        localStorage.setItem('analysisResults', JSON.stringify(data));
        
        // ‚úÖ ALSO save coordinates separately as backup
        const locationData = {
            latitude: selectedLocation.latitude,
            longitude: selectedLocation.longitude,
            farmerName: farmerName,
            method: selectedLocation.method
        };
        localStorage.setItem('locationData', JSON.stringify(locationData));
        
        console.log("üíæ Saved location data:", locationData);
        window.location.href = 'results.html';
    })
    .catch(error => {
        console.error('‚ùå Error connecting to backend:', error);
        // Fallback: Save coordinates even if backend fails
        const fallbackData = {
            farmerName: farmerName,
            location: selectedLocation,
            timestamp: new Date().toISOString()
        };
        localStorage.setItem('farmData', JSON.stringify(fallbackData));
        
        // ‚úÖ ALSO save coordinates separately
        const locationData = {
            latitude: selectedLocation.latitude,
            longitude: selectedLocation.longitude,
            farmerName: farmerName
        };
        localStorage.setItem('locationData', JSON.stringify(locationData));
        
        console.log("üíæ Saved fallback location data:", locationData);
        window.location.href = 'results.html';
    });
}

    </script>

    <style>
        /* Additional styles for location methods */
        .method-section {
            display: none;
            margin-top: 1rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .method-section.active {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }

        .gps-instructions {
            text-align: center;
            margin-bottom: 1rem;
        }

        .gps-instructions p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1rem;
        }

        .gps-detect-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #2f5d33, #3a7a40);
            border: none;
            border-radius: 0.5rem;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .gps-detect-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #3a7a40, #4a9a50);
            transform: translateY(-2px);
        }

        .gps-detect-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .gps-icon {
            font-size: 1.2rem;
        }

        .location-result {
            margin-top: 1rem;
        }

        .location-success {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(47, 93, 51, 0.2);
            border: 1px solid rgba(216, 180, 0, 0.3);
            border-radius: 0.5rem;
        }

        .success-icon {
            font-size: 1.5rem;
        }

        /* Search Styles */
        .search-container {
            width: 100%;
        }

        .search-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            color: white;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.15);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .search-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #d8b400, #e5c34d);
            border: none;
            border-radius: 0.5rem;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #e5c34d, #f2d27a);
            transform: translateY(-2px);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .search-suggestions {
            margin-bottom: 1.5rem;
        }

        .suggestion-header {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
        }

        .suggestion-item {
            padding: 0.5rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.375rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
            color: white;
        }

        .search-results {
            margin: 1rem 0;
        }

        .results-header {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .result-main {
            flex: 1;
        }

        .result-type {
            font-size: 0.8rem;
            color: var(--accent);
            background: rgba(216, 180, 0, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }

        .result-coords {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin: 0 1rem;
        }

        .select-result-btn {
            padding: 0.5rem 1rem;
            background: var(--primary);
            border: none;
            border-radius: 0.375rem;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .select-result-btn:hover {
            background: #3a7a40;
        }

        .no-results {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            padding: 2rem;
        }

        .selected-search-result {
            margin-top: 1rem;
        }

        .selected-location {
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(47, 93, 51, 0.2);
            border: 1px solid rgba(216, 180, 0, 0.3);
            border-radius: 0.5rem;
        }

        .location-display {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .location-icon {
            font-size: 1.5rem;
        }

        .location-info {
            flex: 1;
        }

        .location-info strong {
            color: var(--accent);
            display: block;
            margin-bottom: 0.25rem;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Language Dropdown Styles
.language-dropdown-container {
    position: relative;
    display: inline-block;
}

.language-dropdown-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.language-dropdown-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
}

.current-language {
    font-weight: 500;
}

.dropdown-arrow {
    font-size: 0.7rem;
    transition: transform 0.3s ease;
}

.language-dropdown-btn:hover .dropdown-arrow {
    transform: rotate(180deg);
}

.language-dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: #2d2d2d;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.5rem;
    padding: 0.5rem;
    margin-top: 0.5rem;
    min-width: 120px;
    z-index: 1000;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.language-option {
    padding: 0.75rem 1rem;
    color: white;
    cursor: pointer;
    border-radius: 0.25rem;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.language-option:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #00ff88;
} */

/* Ultra Premium Language Select */
.language-select-container {
    position: relative;
    display: inline-block;
}

.language-select {
    background: linear-gradient(135deg, 
        rgba(40, 40, 40, 0.9) 0%, 
        rgba(30, 30, 30, 0.9) 100%);
    border: 1px solid;
    border-image: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.2), 
        rgba(255, 255, 255, 0.1)) 1;
    color: white;
    padding: 0.7rem 3rem 0.7rem 1.2rem;
    border-radius: 1rem;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    min-width: 150px;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300ff88'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem top 50%;
    background-size: 1rem;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    backdrop-filter: blur(20px);
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
}

.language-select::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent, 
        rgba(0, 255, 136, 0.1), 
        transparent);
    transition: left 0.6s ease;
}

.language-select:hover::before {
    left: 100%;
}

.language-select:hover {
    background: linear-gradient(135deg, 
        rgba(50, 50, 50, 0.9) 0%, 
        rgba(40, 40, 40, 0.9) 100%);
    border-image: linear-gradient(135deg, 
        rgba(0, 255, 136, 0.4), 
        rgba(0, 217, 255, 0.4)) 1;
    transform: translateY(-2px);
    box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.language-select:focus {
    outline: none;
    border-image: linear-gradient(135deg, 
        rgba(0, 255, 136, 0.6), 
        rgba(0, 217, 255, 0.6)) 1;
    box-shadow: 
        0 0 0 3px rgba(0, 255, 136, 0.1),
        0 12px 40px rgba(0, 0, 0, 0.4);
}

.language-select option {
    background: #2d2d2d;
    color: white;
    padding: 1rem;
    font-size: 0.9rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.language-select option:hover {
    background: rgba(0, 255, 136, 0.2);
}

.language-select option:checked {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 217, 255, 0.3));
    color: #00ff88;
    font-weight: 600;
}
   
   /* Custom Language Dropdown - No Rectangular Box */
.custom-language-dropdown {
    position: relative;
    display: inline-block;
    min-width: 140px;
}

.dropdown-selected {
    background: linear-gradient(135deg, 
        rgba(40, 40, 40, 0.9) 0%, 
        rgba(30, 30, 30, 0.9) 100%);
    border: 1px solid;
    border-image: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.2), 
        rgba(255, 255, 255, 0.1)) 1;
    color: white;
    padding: 0.7rem 1.2rem;
    border-radius: 1rem;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    backdrop-filter: blur(20px);
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
    z-index: 1001;
}

.dropdown-selected::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent, 
        rgba(0, 255, 136, 0.1), 
        transparent);
    transition: left 0.6s ease;
}

.dropdown-selected:hover::before {
    left: 100%;
}

.dropdown-selected:hover {
    background: linear-gradient(135deg, 
        rgba(50, 50, 50, 0.9) 0%, 
        rgba(40, 40, 40, 0.9) 100%);
    border-image: linear-gradient(135deg, 
        rgba(0, 255, 136, 0.4), 
        rgba(0, 217, 255, 0.4)) 1;
    transform: translateY(-2px);
    box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.dropdown-arrow {
    transition: transform 0.3s ease;
    color: #00ff88;
}

.dropdown-options {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, 
        rgba(40, 40, 40, 0.95) 0%, 
        rgba(30, 30, 30, 0.95) 100%);
    border: 1px solid;
    border-image: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.15), 
        rgba(255, 255, 255, 0.1)) 1;
    border-radius: 1rem;
    margin-top: 0.5rem;
    padding: 0.5rem;
    backdrop-filter: blur(20px);
    box-shadow: 
        0 15px 50px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    display: none;
    z-index: 1002;
    overflow: hidden;
}

.dropdown-option {
    padding: 0.8rem 1rem;
    color: white;
    cursor: pointer;
    border-radius: 0.75rem;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 500;
    margin: 0.1rem 0;
}

.dropdown-option:hover {
    background: linear-gradient(135deg, 
        rgba(0, 255, 136, 0.2) 0%, 
        rgba(0, 217, 255, 0.2) 100%);
    color: #00ff88;
    transform: translateX(5px);
}

/* When dropdown is active */
.custom-language-dropdown.active .dropdown-options {
    display: block;
    animation: dropdownFadeIn 0.3s ease;
}

.custom-language-dropdown.active .dropdown-arrow {
    transform: rotate(180deg);
}

@keyframes dropdownFadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Close dropdown when clicking outside */
.dropdown-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: transparent;
    z-index: 1000;
    display: none;
}

.custom-language-dropdown.active ~ .dropdown-overlay {
    display: block;
}
   </style>
</body>
</html>